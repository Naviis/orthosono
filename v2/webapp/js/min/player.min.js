var Player=function(){return this.sounds_array=[{name:"animal Abeille",path:"a-abeille"},{name:"animal Canard",path:"a-canard"},{name:"animal Chat",path:"a-chat"},{name:"animal Chat 2",path:"a-chat-2"},{name:"animal Cheval",path:"a-cheval"},{name:"animal Chien",path:"a-chien"},{name:"animal Chien 2",path:"a-chien-2"},{name:"animal Chien 3",path:"a-chien-3"},{name:"animal Coq",path:"a-coq"},{name:"animal Coq 2",path:"a-coq-2"},{name:"animal Corbeaux",path:"a-corbeaux"},{name:"animal Hibou",path:"a-hibou"},{name:"animal Hibou 2",path:"a-hibou-2"},{name:"animal Loup",path:"a-loup"},{name:"animal Mouettes",path:"a-mouettes"},{name:"animal Oie",path:"a-oie"},{name:"animal Oie 2",path:"a-oie-2"},{name:"animal Oie 3",path:"a-oie-3"},{name:"animal Poules",path:"a-poules"},{name:"animal Tigre",path:"a-tigre"},{name:"animal Vache",path:"a-vache"},{name:"animal Vache 2",path:"a-vache-2"},{name:"Appareil photo",path:"appareil-photo"},{name:"Appareil photo 2",path:"appareil-photo-2"},{name:"Applaudissements",path:"applaudissements"},{name:"Applaudissements 2",path:"applaudissements-2"},{name:"Avion",path:"avion"},{name:"Ballon",path:"ballon"},{name:"Bébé pleure",path:"bebe-pleure"},{name:"Bébé",path:"bebe"},{name:"Bisou",path:"bisou"},{name:"Brossage de dents",path:"brossage-de-dents"},{name:"Ciseaux",path:"ciseaux"},{name:"Eternuement",path:"eternuement"},{name:"Feux d'artifice",path:"feux-d-artifice"},{name:"musique Batterie",path:"m-batterie"},{name:"musique Flute",path:"m-flute"},{name:"musique Guitare",path:"m-guitare"},{name:"musique Harpe",path:"m-harpe"},{name:"musique Piano",path:"m-piano"},{name:"musique Saxophone",path:"m-saxophone"},{name:"musique Trombone",path:"m-trombone"},{name:"musique Trompette",path:"m-trompette"},{name:"musique Violon",path:"m-violon"},{name:"musique Violoncelle",path:"m-violoncelle"},{name:"musique Violoncelle 2",path:"m-violoncelle-2"},{name:"musique Violoncelle 3",path:"m-violoncelle-3"},{name:"musique Moto",path:"moto"},{name:"Rires",path:"rires"},{name:"Sirène police",path:"sirene-police"},{name:"Téléphone",path:"telephone"},{name:"Toilettes",path:"toilettes"},{name:"Tonnerre",path:"tonnerre"},{name:"Vagues",path:"vagues"}],this.sounds_path="sounds/",this.extension="ogg",this.playlist=[],this.current=0,this.$e_library=$(".properties_library"),this.$e_selectedSounds=$(".properties_selectedSounds"),this.$e_order=$(".properties_order"),this.$e_delay=$(".properties_delay"),this.e_player=document.getElementById("player"),this.$e_prevBtn=$("#player_prev"),this.$e_nextBtn=$("#player_next"),this.$e_countDown=$(".player_countDown"),this.c_activeCountDown="active",this.$e_playlist=$(".player_playlist"),this.c_playedElement="active",this.silence_delay=0,this.silence_timeout=null,this.silence_interval=null,this.order="normal",this.init()};Player.prototype={init:function(){return this.generateLibrary(),this.generatePlaylist(),this.addEvents(),this},generateLibrary:function(){for(var e=0;e<this.sounds_array.length;e++){var a=this.sounds_array[e],t=$("<li></li>").attr("data-index",e).html(a.name);this.$e_library.append(t)}},generateSelectedSounds:function(){this.$e_selectedSounds.html("");for(var e=0;e<this.playlist.length;e++){var a=this.playlist[e],t=$("<li></li>").attr("data-index",e).html(a.name);this.$e_selectedSounds.append(t)}},generatePlaylist:function(){if(this.reset(),this.$e_playlist.html(""),this.playlist.length){for(var e="random"==this.order?this.shuffle(this.playlist):this.playlist,a=0;a<e.length;a++){var t=e[a],n=$("<li></li>").attr("data-index",a).html(t.name);this.$e_playlist.append(n)}this.changePlayedElementInPlaylist(),this.changePlayerSoundUrl()}},addEvents:function(){var e=this;this.$e_library.on("click","li",function(){e.reset();var a=$(this).attr("data-index");e.playlist.push(e.sounds_array[a]),e.generateSelectedSounds(),e.generatePlaylist()}),this.$e_selectedSounds.on("click","li",function(){e.reset();var a=$(this).attr("data-index");console.log(a),e.playlist.splice(a,1),e.generatePlaylist(),e.generateSelectedSounds()}),this.$e_order.click(function(){e.reset(),e.order=$(this).val(),e.generatePlaylist()}),this.$e_delay.keyup(function(){e.reset();var a=isNaN(parseInt($(this).val()))?0:parseInt($(this).val());e.silence_delay=a}),this.$e_prevBtn.click(function(a){a.preventDefault(),e.changeCurrentSound("previous")}),this.$e_nextBtn.click(function(a){a.preventDefault(),e.changeCurrentSound("next")}),this.$e_playlist.on("click","li",function(){var a=$(this).attr("data-index");e.changeCurrentSound(a)}),this.e_player.addEventListener("ended",function(){e.changeCurrentSound("next")})},changeCurrentSound:function(e){var a=this;if(this.stop(),"previous"==e){var t=this.current-1;this.current=t>=0?t:this.playlist.length-1}else if("next"==e){var t=this.current+1;if(this.playlist.length-1>=t)this.current=t;else{this.current=0;var n=!0}}else this.current=e;this.changePlayedElementInPlaylist(),this.changePlayerSoundUrl(),"undefined"==typeof n&&(this.silence_timeout=window.setTimeout(function(){a.play()},1e3*this.silence_delay),this.silence_delay&&this.launchInterval())},changePlayedElementInPlaylist:function(){var e=this;this.$e_playlist.find("li").each(function(){$(this).hasClass(e.c_playedElement)&&$(this).removeClass(e.c_playedElement),$(this).attr("data-index")==e.current&&$(this).addClass(e.c_playedElement)})},changePlayerSoundUrl:function(){this.e_player.src=this.playlist.length?this.sounds_path+this.playlist[this.current].path+"."+this.extension:""},stop:function(){this.e_player.pause(),this.e_player.currentTime=0,clearTimeout(this.silence_timeout)},play:function(){this.e_player.play()},reset:function(){this.stop(),this.current=0,this.changePlayerSoundUrl()},launchInterval:function(){var e=this,a=this.silence_delay;this.$e_countDown.find("span").html(a),this.$e_countDown.addClass(this.c_activeCountDown),this.silence_interval=window.setInterval(function(){--a>0?e.$e_countDown.find("span").html(a):(clearInterval(e.silence_interval),e.$e_countDown.removeClass(e.c_activeCountDown))},1e3)},shuffle:function(e){for(var a,t,n=e.length;0!==n;)t=Math.floor(Math.random()*n),n-=1,a=e[n],e[n]=e[t],e[t]=a;return e}},$(function(){new Player});