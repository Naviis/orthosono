var Player=function(){return this.sounds_array=[{name:"animal Abeille",path:"a-abeille"},{name:"animal Canard",path:"a-canard"},{name:"animal Chat",path:"a-chat"},{name:"animal Chat 2",path:"a-chat-2"},{name:"animal Cheval",path:"a-cheval"},{name:"animal Chien",path:"a-chien"},{name:"animal Chien 2",path:"a-chien-2"},{name:"animal Chien 3",path:"a-chien-3"},{name:"animal Coq",path:"a-coq"},{name:"animal Coq 2",path:"a-coq-2"},{name:"animal Corbeaux",path:"a-corbeaux"},{name:"animal Hibou",path:"a-hibou"},{name:"animal Hibou 2",path:"a-hibou-2"},{name:"animal Loup",path:"a-loup"},{name:"animal Mouettes",path:"a-mouettes"},{name:"animal Oie",path:"a-oie"},{name:"animal Oie 2",path:"a-oie-2"},{name:"animal Oie 3",path:"a-oie-3"},{name:"animal Poules",path:"a-poules"},{name:"animal Tigre",path:"a-tigre"},{name:"animal Vache",path:"a-vache"},{name:"animal Vache 2",path:"a-vache-2"},{name:"Appareil photo",path:"appareil-photo"},{name:"Appareil photo 2",path:"appareil-photo-2"},{name:"Applaudissements",path:"applaudissements"},{name:"Applaudissements 2",path:"applaudissements-2"},{name:"Avion",path:"avion"},{name:"Ballon",path:"ballon"},{name:"Bébé pleure",path:"bebe-pleure"},{name:"Bébé",path:"bebe"},{name:"Bisou",path:"bisou"},{name:"Brossage de dents",path:"brossage-de-dents"},{name:"Ciseaux",path:"ciseaux"},{name:"Eternuement",path:"eternuement"},{name:"Feux d'artifice",path:"feux-d-artifice"},{name:"musique Batterie",path:"m-batterie"},{name:"musique Flute",path:"m-flute"},{name:"musique Guitare",path:"m-guitare"},{name:"musique Harpe",path:"m-harpe"},{name:"musique Piano",path:"m-piano"},{name:"musique Saxophone",path:"m-saxophone"},{name:"musique Trombone",path:"m-trombone"},{name:"musique Trompette",path:"m-trompette"},{name:"musique Violon",path:"m-violon"},{name:"musique Violoncelle",path:"m-violoncelle"},{name:"musique Violoncelle 2",path:"m-violoncelle-2"},{name:"musique Violoncelle 3",path:"m-violoncelle-3"},{name:"musique Moto",path:"moto"},{name:"Rires",path:"rires"},{name:"Sirène police",path:"sirene-police"},{name:"Téléphone",path:"telephone"},{name:"Toilettes",path:"toilettes"},{name:"Tonnerre",path:"tonnerre"},{name:"Vagues",path:"vagues"}],this.sounds_path="sounds/",this.extension="ogg",this.playlist=[],this.current=0,this.$e_body=$("body"),this.$e_library=$(".properties_library"),this.$e_selectedSounds=$(".properties_selectedSounds"),this.$e_order=$(".properties_order"),this.$e_delay=$(".properties_delay"),this.e_player=document.getElementById("player"),this.$e_prevBtn=$("#player_prev"),this.$e_nextBtn=$("#player_next"),this.$e_countDown=$(".player_countDown"),this.$e_playlist=$(".player_playlist"),this.c_activeClass="active",this.c_rippleClass="g_ripple",this.$e_menuLoad=$(".menu_load"),this.$e_menuSave=$(".menu_save"),this.$e_menuHelp=$(".menu_help"),this.$e_newPreset=$(".presets_new"),this.$e_presetsLoadList=$(".presets_loadList"),this.$e_presetsSaveList=$(".presets_saveList"),this.$e_presetPrompt=$(".presets_prompt"),this.$e_presetName=$(".preset_name"),this.silence_delay=0,this.silence_timeout=null,this.silence_interval=null,this.order="normal",this.name="Réglage par défaut",this.localStorage=!1,this.presets=[],this.init()};Player.prototype={init:function(){return this.checkLocalStorage(),this.loadPresets(),this.generateLibrary(),this.generatePlaylist(),this.addEvents(),this},generateLibrary:function(){for(var e=0;e<this.sounds_array.length;e++){var t=this.sounds_array[e],a=$("<li></li>").attr("data-index",e).html(t.name);this.$e_library.append(a),a.addClass(this.c_rippleClass)}},generateSelectedSounds:function(){this.$e_selectedSounds.html("");for(var e=0;e<this.playlist.length;e++){var t=this.playlist[e],a=$("<li></li>").attr("data-index",e).html(t.name);this.$e_selectedSounds.append(a),a.addClass(this.c_rippleClass)}},generatePlaylist:function(){if(this.reset(),this.$e_playlist.html(""),this.playlist.length){for(var e="random"==this.order?this.shuffle(this.playlist):this.playlist,t=0;t<e.length;t++){var a=e[t],s=$("<li></li>").attr("data-index",t).html(a.name);this.$e_playlist.append(s),s.addClass(this.c_rippleClass)}this.changePlayedElementInPlaylist(),this.changePlayerSoundUrl()}},animate:function(e,t,a,s){window.setTimeout(function(){e.addClass(t)},s*a)},generatePresets:function(){this.$e_presetsSaveList.html(""),this.$e_presetsLoadList.html("");for(var e=0;e<this.presets.length;e++){var t=this.presets[e],a=$("<li></li>").attr("data-id",e).attr("data-name",t.name).html(t.name),s=a.clone();a.addClass(this.c_rippleClass),this.$e_presetsSaveList.append(a),this.$e_presetsLoadList.append(s)}},updateOrder:function(){var e=this;this.$e_order.each(function(){$(this).val()==e.order&&$(this).prop("checked",!0)})},updateDelay:function(){this.$e_delay.val(this.silence_delay)},addEvents:function(){var e=this;this.$e_library.on("click","li",function(){e.reset();var t=$(this).attr("data-index");e.playlist.push(e.sounds_array[t]),e.generateSelectedSounds(),e.generatePlaylist()}),this.$e_selectedSounds.on("click","li",function(){e.reset();var t=$(this).attr("data-index");e.playlist.splice(t,1),e.generatePlaylist(),e.generateSelectedSounds()}),this.$e_order.click(function(){e.reset(),e.order=$(this).val(),e.generatePlaylist()}),this.$e_delay.keyup(function(){e.reset();var t=isNaN(parseInt($(this).val()))?0:parseInt($(this).val());e.silence_delay=t}),this.$e_presetName.keyup(function(t){13==t.which&&(e.$e_presetPrompt.removeClass(e.c_activeClass),e.savePreset(-1),$(this).val("")),e.name=$(this).val()}),this.$e_prevBtn.click(function(t){t.preventDefault(),e.changeCurrentSound("previous")}),this.$e_nextBtn.click(function(t){t.preventDefault(),e.changeCurrentSound("next")}),this.$e_playlist.on("click","li",function(){var t=$(this).attr("data-index");e.changeCurrentSound(t)}),this.e_player.addEventListener("ended",function(){e.changeCurrentSound("next")}),this.$e_menuSave.click(function(){e.$e_body.addClass("saveMenuShown")}),this.$e_menuLoad.click(function(){e.$e_body.addClass("loadMenuShown")}),this.$e_newPreset.on("click",function(){e.$e_presetPrompt.addClass(e.c_activeClass),window.setTimeout(function(){e.$e_presetName.get(0).focus()},600)}),this.$e_presetsSaveList.on("click","li",function(){var t=$(this).attr("data-id");e.name=$(this).attr("data-name"),e.savePreset(t)}),this.$e_presetsLoadList.on("click","li",function(){var t=$(this).attr("data-id");e.loadPreset(t)})},changeCurrentSound:function(e){var t=this;if(this.stop(),"previous"==e){var a=this.current-1;this.current=a>=0?a:this.playlist.length-1}else if("next"==e){var a=this.current+1;if(this.playlist.length-1>=a)this.current=a;else{this.current=0;var s=!0}}else this.current=e;this.changePlayedElementInPlaylist(),this.changePlayerSoundUrl(),"undefined"==typeof s&&(this.silence_timeout=window.setTimeout(function(){t.play()},1e3*this.silence_delay),this.silence_delay&&this.launchInterval())},changePlayedElementInPlaylist:function(){var e=this;this.$e_playlist.find("li").each(function(){$(this).hasClass(e.c_activeClass)&&$(this).removeClass(e.c_activeClass),$(this).attr("data-index")==e.current&&$(this).addClass(e.c_activeClass)})},changePlayerSoundUrl:function(){this.e_player.src=this.playlist.length?this.sounds_path+this.playlist[this.current].path+"."+this.extension:""},stop:function(){this.e_player.pause(),this.e_player.currentTime&&(this.e_player.currentTime=0),clearTimeout(this.silence_timeout)},play:function(){this.e_player.play()},reset:function(){this.stop(),this.current=0,this.changePlayerSoundUrl()},launchInterval:function(){var e=this,t=this.silence_delay;this.$e_countDown.find("span").html(t),this.$e_countDown.addClass(this.c_activeClass),this.silence_interval=window.setInterval(function(){--t>0?e.$e_countDown.find("span").html(t):(clearInterval(e.silence_interval),e.$e_countDown.removeClass(e.c_activeClass))},1e3)},checkLocalStorage:function(){this.localStorage="undefined"!=typeof localStorage,this.localStorage||(this.$e_menuLoad=$(".menu_load").remove(),this.$e_menuSave=$(".menu_save").remove())},loadPresets:function(){this.localStorage&&window.localStorage.getItem("presets")?(this.presets=JSON.parse(window.localStorage.getItem("presets")),this.generatePresets()):window.localStorage.setItem("presets",JSON.stringify(this.presets))},savePreset:function(e){var t={id:this.presets.length,name:this.name,playlist:this.playlist,order:this.order,silence_delay:this.silence_delay};if("undefined"!=typeof this.presets[e]){if(!window.confirm("Ces paramètres existent déjà, la remplacer ?"))return;t.id=e}this.presets[t.id]=t,window.localStorage.setItem("presets",JSON.stringify(this.presets)),this.generatePresets()},loadPreset:function(e){if("undefined"!=typeof this.presets[e]){if(!window.confirm("Charger ces paramètres ?"))return;var t=this.presets[e];this.name=t.name,this.playlist=t.playlist,this.order=t.order,this.silence_delay=t.silence_delay,this.reset(),this.generateSelectedSounds(),this.generatePlaylist(),this.updateOrder(),this.updateDelay(),this.$e_body.removeClass("loadMenuShown")}},shuffle:function(e){for(var t,a,s=e.length;0!==s;)a=Math.floor(Math.random()*s),s-=1,t=e[s],e[s]=e[a],e[a]=t;return e}},$(function(){new Player});